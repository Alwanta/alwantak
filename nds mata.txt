# تحلیل کامل روش Nodal Displacement Sequencing (NDS)

## مقدمه کلی

Nodal Displacement Sequencing (NDS) یک چارچوب تحلیلی پیشرفته برای پیش‌بینی حرکات قیمت در بازارهای مالی است که توسط دکتر ایرج جعفریان توسعه یافته است. این روش بر اساس ترکیب تحلیل چرخه‌ای، نظریه فرکتال، و تحلیل تقارن عمل کرده و بازار را به صورت یک ساختار هندسی ریاضی در نظر می‌گیرد.

## بخش اول: مبانی نظری NDS

### 1. هندسه بازار (Market Geometry)

هندسه بازار بر این اصل استوار است که عملکرد بازار تصادفی نیست، بلکه از الگوی تعیین‌شده‌ای پیروی می‌کند که توسط توابع ریاضی کنترل می‌شود. این ساختار شامل:

- **نودها (Nodes)**: نقاط بحرانی در ساختار هندسی که در آن‌ها بازگشت قیمت رخ می‌دهد
- **توابع و مشتقات**: شبکه‌ای از روابط ریاضی که نودها را تشکیل می‌دهند
- **نقاط بازگشت**: مارکرهایی که تغییر جهت حرکت قیمت را نشان می‌دهند

### 2. مدل کلی برای توابع ترند و Pullback

#### توابع ترند (Trend Functions):
- T₁(t): تابع ترند از Z به N₁
- T₂(t): تابع ترند از S₁ به N₂  
- T₃(t): تابع ترند از S₂ به N₃

#### توابع Pullback:
- P₁(t): تابع pullback از N₁ به S₁
- P₂(t): تابع pullback از N₂ به S₂
- P₃(t): تابع pullback از N₃ به S₃

### 3. نمایش چندجمله‌ای

هر تابع به صورت چندجمله‌ای درجه n نمایش داده می‌شود:

**توابع ترند:**
```
Tᵢ(t) = αᵢ₀ + αᵢ₁t + αᵢ₂t² + ... + αᵢₙtⁿ
```

**توابع Pullback:**
```
Pᵢ(t) = βᵢ₀ + βᵢ₁t + βᵢ₂t² + ... + βᵢₙtⁿ
```

### 4. قیود پیوستگی

برای اطمینان از پیوستگی مدل:
- T₁(t_end) = P₁(t_start)
- P₁(t_end) = T₂(t_start)
- T₂(t_end) = P₂(t_start)
- P₂(t_end) = T₃(t_start)
- T₃(t_end) = P₃(t_start)

### 5. برازش کمترین مربعات

برای برازش توابع چندجمله‌ای به داده‌ها:

**تابع هدف برای کمینه‌سازی:**
```
S = Σᵢ₌₁ᵐ (yᵢ - f(tᵢ))²
```

**حل کمترین مربعات:**
```
α̂ = (XᵀX)⁻¹Xᵀy
```

### 6. مدل یادگیری عمیق

برای بهبود دقت پیش‌بینی، شبکه عصبی اضافه می‌شود:

**تابع ترند با شبکه عصبی:**
```
T̂ᵢ(t; θ) = αᵢ₀ + αᵢ₁t + αᵢ₂t² + ... + αᵢₙtⁿ + NN(t; θ)
```

**تابع خطا:**
```
eᵢ = yᵢ - T̂ᵢ(t; θ)
```

**تابع زیان (MSE):**
```
L(θ) = (1/m) Σᵢ₌₁ᵐ eᵢ²
```

**به‌روزرسانی وزن‌ها:**
```
θ ← θ - η ∂L/∂θ
```

## بخش دوم: تحلیل فرکتالی

### 7. مدل بازگشتی فرکتال

**تقسیم بازگشتی:**
هر تابع ترند T(t) به سه زیرترند تقسیم می‌شود:
```
T(t) = T₁(t) + P₁(t) + T₂(t) + P₂(t) + T₃(t)
```

**نمایش بازگشتی:**
```
T(t) = Σᵢ₌₁³ (Tᵢ(t) + Pᵢ(t))
Tᵢ(t) = Σⱼ₌₁³ (Tᵢⱼ(t) + Pᵢⱼ(t))
```

### 8. ضریب مقیاس‌بندی فرکتال

ضریب مقیاس‌بندی عدد فرکتال 3 است:
- τᵢ = τ/3
- τᵢⱼ = τ/3²
- τᵢⱼₖ = τ/3³

## بخش سوم: تحلیل تقارن

### 9. Hooks (قلاب‌ها)

هر hook حلقه حرکتی قیمت است که 86% از حرکت اولیه خود را برمی‌گرداند:

**بازگشت Hook:**
```
H_retrace = 0.86 × H
```

**باقی‌مانده Hook:**
```
H_remaining = H - H_retrace = 0.14 × H
```

**کل Hook:**
```
H_total = H - 0.86H + H = 0.14H + H
```

### 10. ترندها

هر ترند به صورت متقارن حرکت می‌کند و به سه قسمت مساوی تقسیم می‌شود:
```
T = T/3 + T/3 + T/3
```

### 11. مدل ترکیبی

مدل کامل شامل 2 hook و یک ترند:
```
P(t) = H₁ + H₂ + T
```
که:
- H₁ = 0.14 × H₁,initial + H₁,initial
- H₂ = 0.14 × H₂,initial + H₂,initial  
- T = T/3 + T/3 + T/3

## بخش چهارم: نظریه چرخه تودرتو (Nested Cycle Theory)

### 12. تعریف چرخه

چرخه به عنوان تابع پیوسته Cₖ(t) تعریف می‌شود:
```
Cₖ(t) : [t₀, tf] → ℝ
```

**ویژگی تناوبی:**
```
Cₖ(t + Tₖ) = Cₖ(t)
```

**نودهای چرخه:**
```
nᵢ = Cₖ(tᵢ), i = 1, 2, ..., Nₖ
```

### 13. رابطه بازگشتی چرخه

چرخه در time frame بالاتر از مجموع نسخه‌های مقیاس‌شده چرخه‌های time frame پایین‌تر تشکیل می‌شود:
```
Cₖ(t) = Σⱼ₌₁ᴺᵏ (1/Sₖ) × Cₖ₊₁(t/Sₖ)
```

**مقیاس‌بندی زمان:**
```
tₖ₊₁ = tₖ/Sₖ
```

**مقیاس‌بندی اندازه:**
```
Cₖ₊₁(t) = (1/Sₖᵞ) × Cₖ(t)
```

### 14. هندسه فرکتال و خودشباهتی

تعداد زیرچرخه‌ها با ضریب مقیاس‌بندی از طریق بعد فرکتال D مرتبط است:
```
Nₖ ~ Sₖᴰ
```

### 15. فشار از Time Frameهای بالاتر

فشار از time frame بالاتر k به time frame پایین‌تر k+1:
```
Pₖ(t) = αₖ × dCₖ(t)/dt
```

**تکامل چرخه time frame پایین‌تر:**
```
dCₖ₊₁(t)/dt = f(Cₖ₊₁(t)) + Pₖ(t)
```

### 16. جابجایی نودال

جابجایی نود Δn⁽ᵏ⁾ᵢ متناسب با جابجایی نودهای time frame پایین‌تر و فشار time frame بالاتر:
```
Δn⁽ᵏ⁾ᵢ = βₖ × [Σⱼ₌₁ᴺᵏ Δn⁽ᵏ⁺¹⁾ⱼ + Pₖ(t)]
```

### 17. مثال عددی: YM E-mini Futures

**چرخه اول (Time Frame بالا):**
- n₁ = 32,000
- n₂ = 32,100  
- n₃ = 32,300

**چرخه دوم (Time Frame پایین) با ضریب مقیاس S₁ = 10:**
- n₁⁽²⁾ = 32,000, n₂⁽²⁾ = 32,010, n₃⁽²⁾ = 32,020
- n₄⁽²⁾ = 32,100, n₅⁽²⁾ = 32,110, n₆⁽²⁾ = 32,120
- n₇⁽²⁾ = 32,300, n₈⁽²⁾ = 32,310, n₉⁽²⁾ = 32,320

**محاسبه فشار:**
```
P₁(32,000) = α₁ × dC₁(t)/dt = 0.5 × 100 = 50
```

**جابجایی نودال:**
```
Δn₁⁽²⁾ = β₁ × [Σⱼ₌₁³ Δn⁽³⁾ⱼ + P₁(t)] = 0.01 × (3 + 50) = 0.53
```

## بخش پنجم: توالی اجرا در هندسه بازار NDS

### 18. توالی اولیه NDS

توالی اولیه مسیر زیر را دنبال می‌کند:
```
Z → N₁ → S₁ → N₂ → S₂ → N₃ → S₃
```

**نمایش ریاضی چرخه اول:**
```
f(Z) = N₁ → S₁ → N₂ → S₂ → N₃ → S₃  ... (1)
```

### 19. دو چرخه متوالی NDS

**چرخه اول:**
```
f(Z) = N₁ → S₁ → N₂ → S₂ → N₃ → S₃  ... (2)
```

**چرخه دوم:**
```
f(S₃) = N₄ → S₄ → N₅ → S₅ → N₆ → S₆  ... (3)
```

که Z₂ = S₃ و هر نود در چرخه دوم بالاتر از نود متناظر در چرخه اول است.

### 20. منطق توالی

قوانین تصمیم‌گیری:
- اگر در نود N هستید → حرکت بعدی sell-off به نود S متناظر
- اگر در نود S هستید → حرکت بعدی پیشروی به نود N بعدی

### 21. فرمول کلی هندسه بازار NDS

#### نقطه شروع:
```
f(Zᵢ) = N₁  ... (4)
```

#### حرکت از نود N به ساپورت S:
```
f(Nᵢ) = Sᵢ  ... (5)
```

#### حرکت از ساپورت S به نود بالاتر N:
```
f(Sᵢ) = Nᵢ₊₁  ... (6)
```

#### فرمول کامل کلی:
```
f(Zᵢ) = N₁ → S₁ → N₂ → S₂ → N₃ → S₃ → ... → Nₖ → Sₖ  ... (9)
```

که:
- Zᵢ نقطه شروع توالی
- N₁, N₂, ..., Nₖ نشان‌دهنده قله‌های متوالی بازار
- S₁, S₂, ..., Sₖ نشان‌دهنده pullbackها یا کف‌های متناظر

## خلاصه و نتیجه‌گیری

NDS یک پیشرفت مهم در زمینه پیش‌بینی بازار است که ترکیبی از:

1. **مدل‌سازی ریاضی دقیق** با چندجمله‌ای‌ها و معادلات دیفرانسیل
2. **هوش مصنوعی** با شبکه‌های عصبی و backpropagation
3. **تحلیل فرکتال** با روابط بازگشتی و خودshباهتی
4. **نظریه چرخه تودرتو** با تأثیر time frameهای بالاتر بر پایین‌تر
5. **تحلیل تقارن** با مفهوم hooks و تقسیم‌بندی متقارن ترندها

این روش قادر است با تحلیل بازار به صورت ماتریس نودهای قیمت و اعمال توابع ریاضی پیچیده، پیش‌بینی‌های دقیق و قابل اعتمادی از حرکات بازار ارائه دهد.